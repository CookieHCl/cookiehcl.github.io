<!doctype html><html lang=en><meta charset=UTF-8><meta content="width=device-width" name=viewport><meta content=#222 name=theme-color><meta content="Hexo 7.3.0" name=generator><link crossorigin href=https://cdnjs.cloudflare.com rel=preconnect><link href=/images/apple-touch-icon-next.png rel=apple-touch-icon sizes=180x180><link href=/images/favicon-32x32-next.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16-next.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><link href=/css/main.css rel=stylesheet><link integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css rel=stylesheet><link integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css rel=stylesheet><script class=next-config data-name=main type=application/json>{"hostname":"cookiehcl.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"agate","dark":"agate"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":true,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script defer src=/js/config.js></script><meta content="Problem Ray tracing is too slow. We need to accelerate it! To make ray tracing faster, we need to solve this problem: Given a scene defined by a set of NNN primitives and a ray r(t)\mathbf{r}(t)r(t)," name=description><meta content=article property=og:type><meta content="Spatial Data Structure" property=og:title><meta content=https://cookiehcl.github.io/posts/83/index.html property=og:url><meta content="기억 저장소" property=og:site_name><meta content="Problem Ray tracing is too slow. We need to accelerate it! To make ray tracing faster, we need to solve this problem: Given a scene defined by a set of NNN primitives and a ray r(t)\mathbf{r}(t)r(t)," property=og:description><meta content=en_US property=og:locale><meta content=https://cookiehcl.github.io/posts/83/ray_aabb_intersection.png property=og:image><meta content=https://cookiehcl.github.io/posts/83/bounding_volume_hierarchy.png property=og:image><meta content=https://cookiehcl.github.io/posts/83/k_d_tree.png property=og:image><meta content=https://cookiehcl.github.io/posts/83/k_d_tree_exception.png property=og:image><meta content=https://cookiehcl.github.io/posts/83/k_d_tree_node.png property=og:image><meta content=https://cookiehcl.github.io/posts/83/k_d_tree_traversal.png property=og:image><meta content=https://cookiehcl.github.io/posts/83/uniform_grid.png property=og:image><meta content=https://cookiehcl.github.io/posts/83/octtree.png property=og:image><meta content=2025-05-27T02:04:29.000Z property=article:published_time><meta content=2025-05-27T02:04:29.000Z property=article:modified_time><meta content=CookieHCl property=article:author><meta content=summary name=twitter:card><meta content=https://cookiehcl.github.io/posts/83/ray_aabb_intersection.png name=twitter:image><link href=https://cookiehcl.github.io/posts/83/ rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://cookiehcl.github.io/posts/83/","path":"posts/83/","title":"Spatial Data Structure"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>Spatial Data Structure | 기억 저장소</title><script integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin defer src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script defer src=/js/utils.js></script><script defer src=/js/motion.js></script><script defer src=/js/sidebar.js></script><script defer src=/js/next-boot.js></script><script integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin defer src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js></script><script defer src=/js/third-party/search/local-search.js></script><script class=next-config data-name=mermaid type=application/json>{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.10.1/mermaid.min.js","integrity":"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="}}</script><script defer src=/js/third-party/tags/mermaid.js></script><script class=next-config data-name=enableMath type=application/json>true</script><link integrity="sha256-UF1fgpAiu3tPJN/uCqEUHNe7pnr+QR0SQDNfgglgtcM=" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css rel=stylesheet><script class=next-config data-name=katex type=application/json>{"copy_tex_js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js","integrity":"sha256-Us54+rSGDSTvIhKKUs4kygE2ipA0RXpWWh0/zLqw3bs="}}</script><script defer src=/js/third-party/math/katex.js></script><noscript><link href=/css/noscript.css rel=stylesheet></noscript><body class=use-motion itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label="Toggle navigation bar" class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <i class=logo-line></i> <p class=site-title>기억 저장소</p> <i class=logo-line></i> </a></div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=Search role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-about"><a href=/about/ rel=section><i class="fa fa-user fa-fw"></i>About</a><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>Tags</a><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>Categories</a><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>Archives</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>Search </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=Searching... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class=search-result-container><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>Table of Contents<li class=sidebar-nav-overview>Overview</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>1.</span> <span class=nav-text>Problem</span></a><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>2.</span> <span class=nav-text>Bounding Volume</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#Axis-aligned-bounding-box-AABB><span class=nav-number>2.1.</span> <span class=nav-text>Axis-aligned bounding box (AABB)</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Efficient-Ray-AABB-Intersection><span class=nav-number>2.1.1.</span> <span class=nav-text>Efficient Ray-AABB Intersection</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#Bounding-Volume-Hierarchy-BVH><span class=nav-number>2.2.</span> <span class=nav-text>Bounding Volume Hierarchy (BVH)</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Splitting-objects><span class=nav-number>2.2.1.</span> <span class=nav-text>Splitting objects</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#BVH-Pros-and-Cons><span class=nav-number>2.2.2.</span> <span class=nav-text>BVH Pros and Cons</span></a></ol></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>3.</span> <span class=nav-text>K-D Tree</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#K-D-Tree-Algorithm><span class=nav-number>3.1.</span> <span class=nav-text>K-D Tree Algorithm</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Node><span class=nav-number>3.1.1.</span> <span class=nav-text>Node</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Construction><span class=nav-number>3.1.2.</span> <span class=nav-text>Construction</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Traversal><span class=nav-number>3.1.3.</span> <span class=nav-text>Traversal</span></a></ol></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>4.</span> <span class=nav-text>Uniform Grid</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#Grid-size-heuristic><span class=nav-number>4.1.</span> <span class=nav-text>Grid size heuristic</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#Quadtree-Octree><span class=nav-number>4.2.</span> <span class=nav-text>Quadtree/Octree</span></a></ol></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><p class=site-author-name itemprop=name>CookieHCl<div class=site-description itemprop=description></div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>96</span> <span class=site-state-item-name>posts</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>20</span> <span class=site-state-item-name>categories</span></a></div></nav></div><div class="links-of-author animated"><span class=links-of-author-item> <a rel="noopener me" title="GitHub → https://github.com/CookieHCl" href=https://github.com/CookieHCl target=_blank><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class=links-of-author-item> <a rel="noopener me" title="BOJ → https://www.acmicpc.net/user/CookieHCl" href=https://www.acmicpc.net/user/CookieHCl target=_blank><i class="fa fa-code fa-fw"></i>BOJ</a> </span><span class=links-of-author-item> <a rel="noopener me" title="solved.ac → https://solved.ac/profile/CookieHCl" href=https://solved.ac/profile/CookieHCl target=_blank><i class="fa fa-audio-description fa-fw"></i>solved.ac</a> </span></div><div class="cc-license animated" itemprop=license><a class=cc-opacity href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ko rel=noopener target=_blank><img alt="Creative Commons" src=https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg></a></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article lang=en><link href=https://cookiehcl.github.io/posts/83/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/images/avatar.gif itemprop=image> <meta content=CookieHCl itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content="기억 저장소" itemprop=name> <meta itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="Spatial Data Structure | 기억 저장소" itemprop=name> <meta itemprop=description> </span><header class=post-header><h1 itemprop="name headline" class=post-title>Spatial Data Structure</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>Posted on</span> <time itemprop="dateCreated datePublished" title="Created: 2025-05-27 11:04:29" datetime=2025-05-27T11:04:29+09:00>2025-05-27</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>In</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/SNU/ itemprop=url rel=index><span itemprop=name>SNU</span></a> </span> , <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/SNU/4-1/ itemprop=url rel=index><span itemprop=name>4-1</span></a> </span> , <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/SNU/4-1/%EC%BB%B4%ED%93%A8%ED%84%B0%EA%B7%B8%EB%9E%98%ED%94%BD%EC%8A%A4/ itemprop=url rel=index><span itemprop=name>컴퓨터그래픽스</span></a> </span> </span><span title="Reading time" class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>Reading time ≈</span> <span>3 mins.</span> </span></div></div></header><div class=post-body itemprop=articleBody><h1>Problem</h1><p>Ray tracing is too slow. We need to accelerate it!<br> To make ray tracing faster, we need to solve this problem:<p>Given a scene defined by a set of <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>N</mi></mrow><annotation encoding=application/x-tex>N</annotation></semantics></math></span><span aria-hidden=true class=katex-html><span class=base><span class=strut style=height:0.6833em;></span><span class="mord mathnormal" style=margin-right:0.10903em;>N</span></span></span></span> primitives and a ray <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi mathvariant=bold>r</mi><mo stretchy=false>(</mo><mi>t</mi><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>\mathbf{r}(t)</annotation></semantics></math></span><span aria-hidden=true class=katex-html><span class=base><span class=strut style=height:1em;vertical-align:-0.25em;></span><span class="mord mathbf">r</span><span class=mopen>(</span><span class="mord mathnormal">t</span><span class=mclose>)</span></span></span></span>, find the closest point <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi mathvariant=bold>p</mi></mrow><annotation encoding=application/x-tex>\mathbf{p}</annotation></semantics></math></span><span aria-hidden=true class=katex-html><span class=base><span class=strut style=height:0.6389em;vertical-align:-0.1944em;></span><span class="mord mathbf">p</span></span></span></span> of intersection of <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi mathvariant=bold>r</mi><mo stretchy=false>(</mo><mi>t</mi><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>\mathbf{r}(t)</annotation></semantics></math></span><span aria-hidden=true class=katex-html><span class=base><span class=strut style=height:1em;vertical-align:-0.25em;></span><span class="mord mathbf">r</span><span class=mopen>(</span><span class="mord mathnormal">t</span><span class=mclose>)</span></span></span></span> with the scene.<h1>Bounding Volume</h1><p>Idea: Precompute conservative but smallest bounding volume that includes all primitives, then early reject if ray does not hit the box.<br> Problem: In the worst case, we still need to examine all primitives.<p>Bounding volume should be tight to avoid false positives, and ray-volume intersection should be fast enough.<ul><li>Axis-aligned bounding box<li>Bounding box (Slower)<li>Bounding sphere<li>Bounding half-space (any convex polygon)</ul><h2 id=Axis-aligned-bounding-box-AABB>Axis-aligned bounding box (AABB)</h2><p>Box can be represented as <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mo fence=true>(</mo><mrow><mo fence=true>(</mo><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub><mo separator=true>,</mo><msub><mi>y</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub><mo separator=true>,</mo><msub><mi>z</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub><mo fence=true>)</mo></mrow><mo separator=true>,</mo><mrow><mo fence=true>(</mo><msub><mi>x</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo separator=true>,</mo><msub><mi>y</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo separator=true>,</mo><msub><mi>z</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo fence=true>)</mo></mrow><mo fence=true>)</mo></mrow><annotation encoding=application/x-tex>\left( \left( x_{min}, y_{min}, z_{min} \right), \left( x_{max}, y_{max}, z_{max} \right) \right)</annotation></semantics></math></span><span aria-hidden=true class=katex-html><span class=base><span class=strut style=height:1em;vertical-align:-0.25em;></span><span class=minner><span class="mopen delimcenter" style=top:0em;>(</span><span class=minner><span class="mopen delimcenter" style=top:0em;>(</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:0.1667em;></span><span class=mord><span class="mord mathnormal" style=margin-right:0.03588em;>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em;><span style=top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:0.1667em;></span><span class=mord><span class="mord mathnormal" style=margin-right:0.04398em;>z</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em;><span style=top:-2.55em;margin-left:-0.044em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0em;>)</span></span><span class=mspace style=margin-right:0.1667em;></span><span class=mpunct>,</span><span class=mspace style=margin-right:0.1667em;></span><span class=minner><span class="mopen delimcenter" style=top:0em;>(</span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.1514em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ma</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:0.1667em;></span><span class=mord><span class="mord mathnormal" style=margin-right:0.03588em;>y</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.1514em;><span style=top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ma</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:0.1667em;></span><span class=mord><span class="mord mathnormal" style=margin-right:0.04398em;>z</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.1514em;><span style=top:-2.55em;margin-left:-0.044em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ma</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0em;>)</span></span><span class="mclose delimcenter" style=top:0em;>)</span></span></span></span></span>.<br> How do we compute intersection with ray <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi mathvariant=bold>r</mi><mo stretchy=false>(</mo><mi>t</mi><mo stretchy=false>)</mo><mo>=</mo><mi mathvariant=bold>o</mi><mo>+</mo><mi>t</mi><mi mathvariant=bold>d</mi></mrow><annotation encoding=application/x-tex>\mathbf{r}(t) = \mathbf{o} + t\mathbf{d}</annotation></semantics></math></span><span aria-hidden=true class=katex-html><span class=base><span class=strut style=height:1em;vertical-align:-0.25em;></span><span class="mord mathbf">r</span><span class=mopen>(</span><span class="mord mathnormal">t</span><span class=mclose>)</span><span class=mspace style=margin-right:0.2778em;></span><span class=mrel>=</span><span class=mspace style=margin-right:0.2778em;></span></span><span class=base><span class=strut style=height:0.6667em;vertical-align:-0.0833em;></span><span class="mord mathbf">o</span><span class=mspace style=margin-right:0.2222em;></span><span class=mbin>+</span><span class=mspace style=margin-right:0.2222em;></span></span><span class=base><span class=strut style=height:0.6944em;></span><span class="mord mathnormal">t</span><span class="mord mathbf">d</span></span></span></span>?<h3 id=Efficient-Ray-AABB-Intersection>Efficient Ray-AABB Intersection</h3><p><img alt="Efficient Ray-AABB Intersection" src=ray_aabb_intersection.png><p>For all 6 faces, compute all intersections.<br> e.g. Let's test intersection with <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>x</mi><mo>=</mo><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mrow><annotation encoding=application/x-tex>x=x_{min}</annotation></semantics></math></span><span aria-hidden=true class=katex-html><span class=base><span class=strut style=height:0.4306em;></span><span class="mord mathnormal">x</span><span class=mspace style=margin-right:0.2778em;></span><span class=mrel>=</span><span class=mspace style=margin-right:0.2778em;></span></span><span class=base><span class=strut style=height:0.5806em;vertical-align:-0.15em;></span><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span></span></span></span>.<p><span class=katex-display><span class=katex><span class=katex-mathml><math display=block xmlns=http://www.w3.org/1998/Math/MathML><semantics><mtable columnalign="right left" columnspacing=0em rowspacing=0.25em><mtr><mtd><mstyle displaystyle=true scriptlevel=0><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mstyle></mtd><mtd><mstyle displaystyle=true scriptlevel=0><mrow><mrow></mrow><mo>=</mo><msub><mi mathvariant=bold>n</mi><mi>x</mi></msub><mo>⋅</mo><mi mathvariant=bold>r</mi><mrow><mo fence=true>(</mo><msub><mi>t</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi><mo separator=true>,</mo><mi>x</mi></mrow></msub><mo fence=true>)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=true scriptlevel=0><mrow></mrow></mstyle></mtd><mtd><mstyle displaystyle=true scriptlevel=0><mrow><mrow></mrow><mo>=</mo><msub><mi mathvariant=bold>n</mi><mi>x</mi></msub><mo>⋅</mo><mrow><mo fence=true>(</mo><mi mathvariant=bold>o</mi><mo>+</mo><msub><mi>t</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi><mo separator=true>,</mo><mi>x</mi></mrow></msub><mi mathvariant=bold>d</mi><mo fence=true>)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=true scriptlevel=0><mrow></mrow></mstyle></mtd><mtd><mstyle displaystyle=true scriptlevel=0><mrow><mrow></mrow><mo>=</mo><mo stretchy=false>(</mo><mn>1</mn><mo separator=true>,</mo><mn>0</mn><mo separator=true>,</mo><mn>0</mn><mo stretchy=false>)</mo><mo>⋅</mo><mrow><mo fence=true>(</mo><mi mathvariant=bold>o</mi><mo>+</mo><msub><mi>t</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi><mo separator=true>,</mo><mi>x</mi></mrow></msub><mi mathvariant=bold>d</mi><mo fence=true>)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=true scriptlevel=0><mrow><mo>∴</mo><msub><mi>t</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi><mo separator=true>,</mo><mi>x</mi></mrow></msub></mrow></mstyle></mtd><mtd><mstyle displaystyle=true scriptlevel=0><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><msub><mi>x</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub><mo>−</mo><msub><mi mathvariant=bold>o</mi><mi>x</mi></msub></mrow><msub><mi mathvariant=bold>d</mi><mi>x</mi></msub></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding=application/x-tex>\begin{align*} x_{min} &= \mathbf{n}_x \cdot \mathbf{r}\left( t_{min, x} \right) \\ &= \mathbf{n}_x \cdot \left( \mathbf{o} + t_{min, x}\mathbf{d} \right) \\ &= (1, 0, 0) \cdot \left( \mathbf{o} + t_{min, x}\mathbf{d} \right) \\ \therefore t_{min, x} &= \frac{x_{min} - \mathbf{o}_x}{\mathbf{d}_x} \end{align*}</annotation></semantics></math></span><span aria-hidden=true class=katex-html><span class=base><span class=strut style=height:6.8963em;vertical-align:-3.1982em;></span><span class=mord><span class=mtable><span class=col-align-r><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:3.6982em;><span style=top:-6.1185em;><span class=pstrut style=height:3.2603em;></span><span class=mord><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span></span></span><span style=top:-4.6185em;><span class=pstrut style=height:3.2603em;></span><span class=mord></span></span><span style=top:-3.1185em;><span class=pstrut style=height:3.2603em;></span><span class=mord></span></span><span style=top:-1.1982em;><span class=pstrut style=height:3.2603em;></span><span class=mord><span class="mrel amsrm">∴</span><span class=mspace style=margin-right:0.2778em;></span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.2861em;><span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:3.1982em;><span></span></span></span></span></span><span class=col-align-l><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:3.6982em;><span style=top:-6.1185em;><span class=pstrut style=height:3.2603em;></span><span class=mord><span class=mord></span><span class=mspace style=margin-right:0.2778em;></span><span class=mrel>=</span><span class=mspace style=margin-right:0.2778em;></span><span class=mord><span class="mord mathbf">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.1514em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class=mspace style=margin-right:0.2222em;></span><span class=mbin>⋅</span><span class=mspace style=margin-right:0.2222em;></span><span class="mord mathbf">r</span><span class=mspace style=margin-right:0.1667em;></span><span class=minner><span class="mopen delimcenter" style=top:0em;>(</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.2861em;><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0em;>)</span></span></span></span><span style=top:-4.6185em;><span class=pstrut style=height:3.2603em;></span><span class=mord><span class=mord></span><span class=mspace style=margin-right:0.2778em;></span><span class=mrel>=</span><span class=mspace style=margin-right:0.2778em;></span><span class=mord><span class="mord mathbf">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.1514em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class=mspace style=margin-right:0.2222em;></span><span class=mbin>⋅</span><span class=mspace style=margin-right:0.2222em;></span><span class=minner><span class="mopen delimcenter" style=top:0em;>(</span><span class="mord mathbf">o</span><span class=mspace style=margin-right:0.2222em;></span><span class=mbin>+</span><span class=mspace style=margin-right:0.2222em;></span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.2861em;><span></span></span></span></span></span></span><span class="mord mathbf">d</span><span class="mclose delimcenter" style=top:0em;>)</span></span></span></span><span style=top:-3.1185em;><span class=pstrut style=height:3.2603em;></span><span class=mord><span class=mord></span><span class=mspace style=margin-right:0.2778em;></span><span class=mrel>=</span><span class=mspace style=margin-right:0.2778em;></span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:0.1667em;></span><span class=mord>0</span><span class=mpunct>,</span><span class=mspace style=margin-right:0.1667em;></span><span class=mord>0</span><span class=mclose>)</span><span class=mspace style=margin-right:0.2222em;></span><span class=mbin>⋅</span><span class=mspace style=margin-right:0.2222em;></span><span class=minner><span class="mopen delimcenter" style=top:0em;>(</span><span class="mord mathbf">o</span><span class=mspace style=margin-right:0.2222em;></span><span class=mbin>+</span><span class=mspace style=margin-right:0.2222em;></span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.2861em;><span></span></span></span></span></span></span><span class="mord mathbf">d</span><span class="mclose delimcenter" style=top:0em;>)</span></span></span></span><span style=top:-1.1982em;><span class=pstrut style=height:3.2603em;></span><span class=mord><span class=mord></span><span class=mspace style=margin-right:0.2778em;></span><span class=mrel>=</span><span class=mspace style=margin-right:0.2778em;></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.2603em;><span style=top:-2.314em;><span class=pstrut style=height:3em;></span><span class=mord><span class=mord><span class="mord mathbf">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.1514em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span></span></span><span style=top:-3.23em;><span class=pstrut style=height:3em;></span><span class=frac-line style=border-bottom-width:0.04em;></span></span><span style=top:-3.677em;><span class=pstrut style=height:3em;></span><span class=mord><span class=mord><span class="mord mathnormal">x</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class=mspace style=margin-right:0.2222em;></span><span class=mbin>−</span><span class=mspace style=margin-right:0.2222em;></span><span class=mord><span class="mord mathbf">o</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.1514em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.836em;><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:3.1982em;><span></span></span></span></span></span></span></span></span></span></span></span><p>Now we have the interval <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mo fence=true>[</mo><msub><mi>t</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi><mo separator=true>,</mo><mi>x</mi></mrow></msub><mo separator=true>,</mo><msub><mi>t</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mo separator=true>,</mo><mi>x</mi></mrow></msub><mo fence=true>]</mo></mrow><annotation encoding=application/x-tex>\left[ t_{min, x}, t_{max, x}\right]</annotation></semantics></math></span><span aria-hidden=true class=katex-html><span class=base><span class=strut style=height:1.0361em;vertical-align:-0.2861em;></span><span class=minner><span class="mopen delimcenter" style=top:0em;>[</span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">min</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.2861em;><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:0.1667em;></span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.1514em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ma</span><span class="mord mathnormal mtight">x</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.2861em;><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0em;>]</span></span></span></span></span> that overlaps the box along x axis.<br> We do the same for y and z axes, then we compute the intersection of these intervals.<figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br></pre><td class=code><pre><span class=line>[t_enter, t_exit] = [-∞, +∞]</span><br><span class=line></span><br><span class=line><span class=keyword>for</span> each dimension k:</span><br><span class=line>    invD  = <span class=number>1</span> / d_k</span><br><span class=line>    t_min = (k_min - o_k) * invD</span><br><span class=line>    t_max = (k_max - o_k) * invD</span><br><span class=line></span><br><span class=line>    <span class=keyword>if</span> t_min > t_max:</span><br><span class=line>        t_min, t_max = t_max, t_min <span class=comment># swap</span></span><br><span class=line></span><br><span class=line>    t_enter = <span class=built_in>max</span>(t_enter, t_min)</span><br><span class=line>    t_exit  = <span class=built_in>min</span>(t_exit, t_max)</span><br><span class=line></span><br><span class=line><span class=keyword>if</span> t_enter > t_exit:</span><br><span class=line>    <span class=keyword>return</span> -<span class=number>1</span> <span class=comment># box missed</span></span><br><span class=line><span class=keyword>elif</span> t_exit &lt; <span class=number>0</span>:</span><br><span class=line>    <span class=keyword>return</span> -<span class=number>1</span> <span class=comment># box is behind the ray</span></span><br><span class=line><span class=keyword>elif</span> t_enter &lt; <span class=number>0</span>:</span><br><span class=line>    <span class=keyword>return</span> t_exit <span class=comment># closest intersection</span></span><br><span class=line><span class=keyword>else</span>:</span><br><span class=line>    <span class=keyword>return</span> t_enter <span class=comment># closest intersection</span></span><br></pre></table></figure><h2 id=Bounding-Volume-Hierarchy-BVH>Bounding Volume Hierarchy (BVH)</h2><p><img alt="Bounding Volume Hierarchy" src=bounding_volume_hierarchy.png><p>Build a binary tree, then find the bounding box of each node.<br> Finding AABB of AABBs is really easy! Just compute min and max coordinates.<p>We traversal node only if its bounding box intersects the ray.<br> If the bounding boxes of multiple child nodes intersect with the ray, we must traverse each of those nodes.<h3 id=Splitting-objects>Splitting objects</h3><p>There is no one correct answer!<br> Different strategies may work better for different types of geometry/different distributions of primitives.<p>Also, we cannot handle every worst case!<br> e.g. All primitives shares same centriod, all primitives have same minimal AABB, ...<br> We use heuristics that can handle most cases.<ul><li>Split at midpoint of the current volume<li>Sort objects, then put half of objects on each side.<li>Use modeling hierarchy as a bounding volume hierarchy. (Actuall works well)<li>Use surface area as a heuristic <ul><li>Assume rays are randomly distributed, and there are no occlusion. (i.e. Objects doesn't block other objects)<li>The probability that a ray will hit an object is proportional to the object's surface area.</ul></ul><h3 id=BVH-Pros-and-Cons>BVH Pros and Cons</h3><ul><li>Easy to construct<li>Easy to traverse<li>Use simple data structure (binary tree)<li>Finding a good split for a node is difficult<li>Poor split may result in minimal spatial pruning</ul><h1>K-D Tree</h1><p><img alt="K-D Tree" src=k_d_tree.png><p>Recursively partition space via axis-aligned partitioning planes.<br> Nodes can be traversed in front-to-back order!<p><img alt="K-D Tree exception" src=k_d_tree_exception.png><p>Unfortunately, traversing space in front-to-back order does not guarantee that primitives will be traversed in front-to-back order.<br> In general, we cannot early exit after first hit is found.<br> However, if object-partition inclusion relationship is uniquely determined, (i.e. no object overlaps more than one partition) we can early exit!<p>This is the algorithm that is currently being used in hardware!<br> Most ray tracing is done with the K-D Tree algorithm.<h2 id=K-D-Tree-Algorithm>K-D Tree Algorithm</h2><h3 id=Node>Node</h3><p><img alt="K-D Tree Node" src=k_d_tree_node.png><p>Each node has two child nodes, axis to split (e.g. <code>dimSplit=0</code> means x aixs), split distance, and the list of primitives if the node is the leaf node.<h3 id=Construction>Construction</h3><ol><li>Start with axis-aligned bounding box of the scene.<li>Decide which dimension to split (e.g. longest)<li>Decide at which distance to split (e.g. half? not so easy to determine)<li>Distribute primitives to each side. If a primitive overlaps split plane, assign it to both sides.<li>Repeat until stopping criteria reached (e.g. minimum number of primitives in node)</ol><h3 id=Traversal>Traversal</h3><p><img alt="K-D Tree Traversal" src=k_d_tree_traversal.png><p>Get intersection from parent bounding box and the current spliting plane.<p>If the ray does not hit parent bounding boxes, ignore this node.<br> If the ray does hit parent bounding box,<ul><li>Traversal left child node if <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>t</mi><mrow><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow></msub><mo>&lt;</mo><msub><mi>t</mi><mrow><mi>e</mi><mi>x</mi><mi>i</mi><mi>t</mi></mrow></msub><mo>&lt;</mo><mi>t</mi></mrow><annotation encoding=application/x-tex>t_{enter} &lt; t_{exit} &lt; t</annotation></semantics></math></span><span aria-hidden=true class=katex-html><span class=base><span class=strut style=height:0.7651em;vertical-align:-0.15em;></span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.2806em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style=margin-right:0.02778em;>er</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class=mspace style=margin-right:0.2778em;></span><span class=mrel>&lt;</span><span class=mspace style=margin-right:0.2778em;></span></span><span class=base><span class=strut style=height:0.7651em;vertical-align:-0.15em;></span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class=mspace style=margin-right:0.2778em;></span><span class=mrel>&lt;</span><span class=mspace style=margin-right:0.2778em;></span></span><span class=base><span class=strut style=height:0.6151em;></span><span class="mord mathnormal">t</span></span></span></span>.<li>Traversal both child node if <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>t</mi><mrow><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow></msub><mo>&lt;</mo><mi>t</mi><mo>&lt;</mo><msub><mi>t</mi><mrow><mi>e</mi><mi>x</mi><mi>i</mi><mi>t</mi></mrow></msub></mrow><annotation encoding=application/x-tex>t_{enter} &lt; t &lt; t_{exit}</annotation></semantics></math></span><span aria-hidden=true class=katex-html><span class=base><span class=strut style=height:0.7651em;vertical-align:-0.15em;></span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.2806em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style=margin-right:0.02778em;>er</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class=mspace style=margin-right:0.2778em;></span><span class=mrel>&lt;</span><span class=mspace style=margin-right:0.2778em;></span></span><span class=base><span class=strut style=height:0.6542em;vertical-align:-0.0391em;></span><span class="mord mathnormal">t</span><span class=mspace style=margin-right:0.2778em;></span><span class=mrel>&lt;</span><span class=mspace style=margin-right:0.2778em;></span></span><span class=base><span class=strut style=height:0.7651em;vertical-align:-0.15em;></span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span></span></span></span>.<li>Traversal right child node if <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>t</mi><mo>&lt;</mo><msub><mi>t</mi><mrow><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow></msub><mo>&lt;</mo><msub><mi>t</mi><mrow><mi>e</mi><mi>x</mi><mi>i</mi><mi>t</mi></mrow></msub></mrow><annotation encoding=application/x-tex>t &lt; t_{enter} &lt; t_{exit}</annotation></semantics></math></span><span aria-hidden=true class=katex-html><span class=base><span class=strut style=height:0.6542em;vertical-align:-0.0391em;></span><span class="mord mathnormal">t</span><span class=mspace style=margin-right:0.2778em;></span><span class=mrel>&lt;</span><span class=mspace style=margin-right:0.2778em;></span></span><span class=base><span class=strut style=height:0.7651em;vertical-align:-0.15em;></span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.2806em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style=margin-right:0.02778em;>er</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span><span class=mspace style=margin-right:0.2778em;></span><span class=mrel>&lt;</span><span class=mspace style=margin-right:0.2778em;></span></span><span class=base><span class=strut style=height:0.7651em;vertical-align:-0.15em;></span><span class=mord><span class="mord mathnormal">t</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em;><span style=top:-2.55em;margin-left:0em;margin-right:0.05em;><span class=pstrut style=height:2.7em;></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em;><span></span></span></span></span></span></span></span></span></span>.</ul><h1>Uniform Grid</h1><p><img alt="Uniform Grid" src=uniform_grid.png><p>Partition space into equal sized volumes. (called volume-elements or voxels)<br> Each grid cell contains primitives that overlap voxel.<ul><li>Like K-D Tree, we can traversal volume in front-to-back order.<li>Very efficient because line rasterization algorithm can be used!<li>Constructing is easy<li>Teapot in a stadium problem: If primitive distribution is non-uniform, (e.g. high-resolution object such as teapot end up in one grid cell) uniform grid won't work.</ul><h2 id=Grid-size-heuristic>Grid size heuristic</h2><p>Too few grid cells degenerates to brute-force approach.<br> Too many grid cells incur significant cost traversing through cells with empty space.<p>We can choose number of voxels proportional to the total number of primitives.<br> Assuming uniform distrubtion, the intersection cost is <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>O</mi><mo stretchy=false>(</mo><mroot><mi>n</mi><mn>3</mn></mroot><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>O(\sqrt[3]{n})</annotation></semantics></math></span><span aria-hidden=true class=katex-html><span class=base><span class=strut style=height:1.0503em;vertical-align:-0.25em;></span><span class="mord mathnormal" style=margin-right:0.02778em;>O</span><span class=mopen>(</span><span class="mord sqrt"><span class=root><span class=vlist-t><span class=vlist-r><span class=vlist style=height:0.6586em;><span style=top:-2.8363em;><span class=pstrut style=height:2.5em;></span><span class="sizing reset-size6 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.8003em;><span class=svg-align style=top:-3em;><span class=pstrut style=height:3em;></span><span class=mord style=padding-left:0.833em;><span class="mord mathnormal">n</span></span></span><span style=top:-2.7603em;><span class=pstrut style=height:3em;></span><span class=hide-tail style=min-width:0.853em;height:1.08em;><svg preserveaspectratio="xMinYMin slice" viewbox="0 0 400000 1080" height=1.08em width=400em xmlns=http://www.w3.org/2000/svg><path d="M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z"/></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.2397em;><span></span></span></span></span></span><span class=mclose>)</span></span></span></span>.<h2 id=Quadtree-Octree>Quadtree/Octree</h2><p><img alt=Octree src=octtree.png><p>Quadtree/Octree has greater ability to adapt to location of scene geometry than uniform grid in 2D/3D.<br> i.e. It can handle some non-uniform primitive distribution.<p>But it has lower intersection performance than K-D tree.<br> i.e. It has limited ability to adapt.<p>Each node in quadtree/octree can have at most 4/8 child nodes, divided by the plane on each axis.<br> If node have enough primitives, recursively divide into 4/8 child nodes.</div><footer class=post-footer><div class=post-nav><div class=post-nav-item><a title="Reading Data from Memory" href=/posts/82/ rel=prev> <i class="fa fa-angle-left"></i> Reading Data from Memory </a></div><div class=post-nav-item><a title="Link Virtualization" href=/posts/93/ rel=next> Link Virtualization <i class="fa fa-angle-right"></i> </a></div></div></footer></article></div><div class="comments utterances-container"></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>© 2023 – <span itemprop=copyrightYear>2025</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>CookieHCl</span></div><div class=powered-by>Powered by <a href=https://hexo.io/ rel=noopener target=_blank>Hexo</a> & <a href=https://theme-next.js.org/muse/ rel=noopener target=_blank>NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div><div class=sidebar-dimmer></div><div aria-label="Back to top" class=back-to-top role=button><i class="fa fa-arrow-up fa-lg"></i><span>0%</span></div><div class=reading-progress-bar></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><script class=next-config data-name=utterances type=application/json>{"enable":true,"repo":"CookieHCl/cookiehcl.github.io","issue_term":"pathname","theme":"github-light"}</script><script defer src=/js/third-party/comments/utterances.js></script>