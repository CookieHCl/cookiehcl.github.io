<!doctype html><html lang=en><meta charset=UTF-8><meta content="width=device-width" name=viewport><meta content=#222 name=theme-color><meta content="Hexo 7.3.0" name=generator><link crossorigin href=https://cdnjs.cloudflare.com rel=preconnect><link href=/images/apple-touch-icon-next.png rel=apple-touch-icon sizes=180x180><link href=/images/favicon-32x32-next.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16-next.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><link href=/css/main.css rel=stylesheet><link integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css rel=stylesheet><link integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css rel=stylesheet><script class=next-config data-name=main type=application/json>{"hostname":"cookiehcl.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"agate","dark":"agate"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":true,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script defer src=/js/config.js></script><meta content="Introduction Hardware should support certain features to run OS properly! I/O  I/O devices and CPU can execute concurrently Each device controller is in charge of a particular device type Each device" name=description><meta content=article property=og:type><meta content="Architectural Support" property=og:title><meta content=https://cookiehcl.github.io/posts/103/index.html property=og:url><meta content="기억 저장소" property=og:site_name><meta content="Introduction Hardware should support certain features to run OS properly! I/O  I/O devices and CPU can execute concurrently Each device controller is in charge of a particular device type Each device" property=og:description><meta content=en_US property=og:locale><meta content=2025-09-09T04:01:27.000Z property=article:published_time><meta content=2025-09-09T04:01:27.000Z property=article:modified_time><meta content=CookieHCl property=article:author><meta content=summary name=twitter:card><link href=https://cookiehcl.github.io/posts/103/ rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://cookiehcl.github.io/posts/103/","path":"posts/103/","title":"Architectural Support"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>Architectural Support | 기억 저장소</title><script integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin defer src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script defer src=/js/utils.js></script><script defer src=/js/motion.js></script><script defer src=/js/sidebar.js></script><script defer src=/js/next-boot.js></script><script integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin defer src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js></script><script defer src=/js/third-party/search/local-search.js></script><script class=next-config data-name=mermaid type=application/json>{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.10.1/mermaid.min.js","integrity":"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="}}</script><script defer src=/js/third-party/tags/mermaid.js></script><script class=next-config data-name=enableMath type=application/json>true</script><link integrity="sha256-UF1fgpAiu3tPJN/uCqEUHNe7pnr+QR0SQDNfgglgtcM=" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css rel=stylesheet><script class=next-config data-name=katex type=application/json>{"copy_tex_js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js","integrity":"sha256-Us54+rSGDSTvIhKKUs4kygE2ipA0RXpWWh0/zLqw3bs="}}</script><script defer src=/js/third-party/math/katex.js></script><noscript><link href=/css/noscript.css rel=stylesheet></noscript><body class=use-motion itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label="Toggle navigation bar" class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <i class=logo-line></i> <p class=site-title>기억 저장소</p> <i class=logo-line></i> </a></div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=Search role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-about"><a href=/about/ rel=section><i class="fa fa-user fa-fw"></i>About</a><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>Tags</a><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>Categories</a><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>Archives</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>Search </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=Searching... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class=search-result-container><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>Table of Contents<li class=sidebar-nav-overview>Overview</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>1.</span> <span class=nav-text>Introduction</span></a><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>2.</span> <span class=nav-text>I/O</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#Interrupts><span class=nav-number>2.1.</span> <span class=nav-text>Interrupts</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#Data-Transfer-Modes><span class=nav-number>2.2.</span> <span class=nav-text>Data Transfer Modes</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>3.</span> <span class=nav-text>Protection</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#Priviledged-instructions-protected-instructions><span class=nav-number>3.1.</span> <span class=nav-text>Priviledged instructions (protected instructions)</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>4.</span> <span class=nav-text>Servicing Requests</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#System-Calls><span class=nav-number>4.1.</span> <span class=nav-text>System Calls</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#Exceptional-Events><span class=nav-number>4.2.</span> <span class=nav-text>Exceptional Events</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#OS-Trap><span class=nav-number>4.3.</span> <span class=nav-text>OS Trap</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>5.</span> <span class=nav-text>Control</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#Timers><span class=nav-number>5.1.</span> <span class=nav-text>Timers</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>6.</span> <span class=nav-text>Memory</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#Simplest-Memory-Protection><span class=nav-number>6.1.</span> <span class=nav-text>Simplest Memory Protection</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#Virtual-Memory><span class=nav-number>6.2.</span> <span class=nav-text>Virtual Memory</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>7.</span> <span class=nav-text>Synchronization</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#Atomic-Instructions><span class=nav-number>7.1.</span> <span class=nav-text>Atomic Instructions</span></a></ol></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><p class=site-author-name itemprop=name>CookieHCl<div class=site-description itemprop=description></div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>101</span> <span class=site-state-item-name>posts</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>24</span> <span class=site-state-item-name>categories</span></a></div></nav></div><div class="links-of-author animated"><span class=links-of-author-item> <a rel="noopener me" title="GitHub → https://github.com/CookieHCl" href=https://github.com/CookieHCl target=_blank><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class=links-of-author-item> <a rel="noopener me" title="BOJ → https://www.acmicpc.net/user/CookieHCl" href=https://www.acmicpc.net/user/CookieHCl target=_blank><i class="fa fa-code fa-fw"></i>BOJ</a> </span><span class=links-of-author-item> <a rel="noopener me" title="solved.ac → https://solved.ac/profile/CookieHCl" href=https://solved.ac/profile/CookieHCl target=_blank><i class="fa fa-audio-description fa-fw"></i>solved.ac</a> </span></div><div class="cc-license animated" itemprop=license><a class=cc-opacity href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ko rel=noopener target=_blank><img alt="Creative Commons" src=https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg></a></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article lang=en><link href=https://cookiehcl.github.io/posts/103/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/images/avatar.gif itemprop=image> <meta content=CookieHCl itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content="기억 저장소" itemprop=name> <meta itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="Architectural Support | 기억 저장소" itemprop=name> <meta itemprop=description> </span><header class=post-header><h1 itemprop="name headline" class=post-title>Architectural Support</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>Posted on</span> <time itemprop="dateCreated datePublished" title="Created: 2025-09-09 13:01:27" datetime=2025-09-09T13:01:27+09:00>2025-09-09</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>In</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/SNU/ itemprop=url rel=index><span itemprop=name>SNU</span></a> </span> , <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/SNU/4-2/ itemprop=url rel=index><span itemprop=name>4-2</span></a> </span> , <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/SNU/4-2/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/ itemprop=url rel=index><span itemprop=name>운영체제</span></a> </span> </span><span title="Reading time" class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>Reading time ≈</span> <span>4 mins.</span> </span></div></div></header><div class=post-body itemprop=articleBody><h1>Introduction</h1><p>Hardware should support certain features to run OS properly!<h1>I/O</h1><ul><li>I/O devices and CPU can execute concurrently<li>Each device controller is in charge of a particular device type<li>Each device has a local buffer<li>CPU issues specific commands to I/O devices<li>CPU moves data between main memory and local buffers</ul><p>Problem: I/O is too slow (sometimes, its time is unknown e.g. keyboards)<br> CPU is a precious resource, it should be freed from time-consuming tasks!<h2 id=Interrupts>Interrupts</h2><p>Instead of polling (periodically checking whether the issued command has been completed or not), we use (hardware) interrupts.<p>e.g. We want to read a file from the disk.<ol><li>CPU asks disk controller to read a file. (Then it runs other processes until interrupt happens.)<li>Disk controller reads file.<li>Disk controller read file completely and send interrupt signal to interrupt controller.<li>Interrupt controller sends interrupt signal to CPU.<li>Interrupt controller sends interrupt information (e.g. who interrupted) to CPU.<li>CPU perform current instruction and preserves the state of the CPU. (e.g. registers, program counter)<li>CPU determines the interrupt's type. (polling or vectored interrupt system)<li>CPU transfers control to the ISR (interrupt service routine) or interrupt handler.<li>ISR or interrupt handler transfers control back to the next instruction.</ol><p>Some I/O devices are too fast!<br> To reduce context switching with interrupts, some user programs directly polls I/O hardware.<h2 id=Data-Transfer-Modes>Data Transfer Modes</h2><ul><li>PIO (Programmed I/O) <ul><li>CPU moves data between I/O devices and memory.<li>Can use special I/O instructions or memory-mapped I/O.<li>Problem: CPU can only use registers! CPU can only move up to 64bit.</ul><li>DMA (Direct Memory Access) <ul><li>Device controller transfers blocks of data from the local buffer directly to main memory without CPU intervention.<li>Only one interrupt is generated per request (after DMA finished).<li>We don't have to waste CPU time!</ul></ul><h1>Protection</h1><p>How to prevent user applications from harming the system?<ul><li>Application shouldn't access disk drives directly.<li>Application shouldn't execute the privileged instructions. (e.g. HLT instruction stops the processor)</ul><h2 id=Priviledged-instructions-protected-instructions>Priviledged instructions (protected instructions)</h2><p>Only kernel mode can perform certain tasks.<p>e.g. direct I/O access, accessing system registers, memory state management (page table, TLB, etc)<p>How does the CPU know if a protected instruction can be executed?<br> The architecture supports several modes of operation.<ul><li>x86_64: Ring 0 (kernel) > Ring 1 > Ring 2 > Ring 3 (user)<br> Ring 1, 2 were ment to be used by device drivers, but using system call was too slow.<br> Most device drivers only uses Ring 0.<li>ARM: EL3 > EL2 > EL1 > EL0<li>RISC-V: Machine (only when booting) > Supervisor (kernel) > User</ul><p>Mode can be set by a status bit in a protected register.<h1>Servicing Requests</h1><p>Okay, OS prevents applications from performing certain tasks.<br> Then how do we ask services to the OS?<br> e.g. How can an application read a file if it cannot access disk drives?<h2 id=System-Calls>System Calls</h2><p>OS defines a set of system calls - a programming interface to the services provided by OS.<br> OS may reject an illegal request, impose a quota on a certain resources, or consider fairness when sharing resources.<p>A system call is a protected procedure call!<br> On entry, CPU switch to the kernel mode.<br> On exit, CPU switch back to the user mode.<h2 id=Exceptional-Events>Exceptional Events</h2><ul><li>Interrupts <ul><li>Generated by hardware devices<li>Asynchronous</ul><li>Exceptions <ul><li>Generated by software executing instructions <ul><li>Can be unintentional; e.g. divide by zero<li>Can be intentional; e.g. syscall instruction</ul><li>Synchronous<li>Exception handling is same as interrupt handling</ul></ul><p>Exceptions are called differently for each CPU.<p>e.g. In x86_64, exceptions are divided into three categories.<ul><li>Traps <ul><li>Intentional<li>e.g. system call, breakpoint, special instructions, ...<li>Return control to next instruction</ul><li>Faults <ul><li>Unintentional but possibly recoverable<li>e.g. page faults, protection faults, ...<li>Re-execute faulting instruction or abort</ul><li>Abort <ul><li>Unintentional and unrecoverable<li>e.g. parity error, machine check, ...<li>Abort the current program or halt the system</ul></ul><h2 id=OS-Trap>OS Trap</h2><p>There must be a special trap instruction that:<ul><li>Causes an exception, which invokes a kernel handler (i.e. runs in kernel mode)<li>Passes a parameter indicating which system call to invoke<li>Save caller's state (e.g. registers, mode bits)<li>Returns to user mode when done with restoring its state<li>OS must verify caller's parameters</ul><p>e.g. x86_64 have SYSCALL instruction<p>c.f. Monolithic kernel: Kernel provide all services: memory, file system, device driver, etc.<br> Microkernel: Kernel only support basic memory management, process scheduling, etc. File system, device driver is in user level.<br> Microkernel is safer (if file system has error, we can just reboot file system), but it is slower (message should be sent between kernel and file system, can't be done in single system call).<h1>Control</h1><p>How to take the control of the CPU back from the running program?<br> We need to run other processes, system calls, etc.<ul><li>Each application periodically transfers the control of the CPU to OS by calling various system calls.<li>A special system call can be used just to release the CPU. (e.g. yield())</ul><p>Problem) What if application doesn't call system calls?<br> What if a process ends up in an infinite loop?<h2 id=Timers>Timers</h2><p>A non-cooperative approach: Use a hardware timer that generates a periodic interrupt.<br> The OS is guaranteed to always get CPU back within a fixed time period!<p>The timer is privileged - Only the OS can load it!<br> e.g. Linux use 10ms for 2.4, 1ms for 2.6, 4ms for 5.5<h1>Memory</h1><p>Applications can't access hardware resources.<br> But applications can access (read/write) memory directly!!!<p>Theoretically, memory should be accessed by a system call, but that will make process too slow!<p>Also, since memory should be fast, hardware should support memory protection instead of software.<br> But if the OS has all the information, how can hardware determine whether memory access is valid?<h2 id=Simplest-Memory-Protection>Simplest Memory Protection</h2><p>Use base/limit registers!<br> Each process can only read/write memory if the memory address is out of bound.<p>Can be useful in a simple embedded environment!<h2 id=Virtual-Memory>Virtual Memory</h2><p>Modern CPU have dedicated memory management hardware! (MMU - Memory Management Unit)<p>MMU can provide more sophisticated memory protection mechanisms.<ul><li>Virtual memory<li>Paging, page tables, page protections, TLBs<li>Memory segmentation</ul><p>Obviously manipulating MMU is a privileged operation<h1>Synchronization</h1><p>Problem) Interrupt can occur at any time and may interfere with the interrupted code.<br> How do we coordinate concurrent activities?<p>c.f. Heisenbug: Bug disappears or alter its behavior when one attempts to study it.<br> This is because thread timing is almost random!<h2 id=Atomic-Instructions>Atomic Instructions</h2><p>CPU supports atomic instructions which help with writing multithreaded code!<br> e.g. RISC-V has AMO (Atomic Memory Operation) instructions which can swap, add integer, bitwise and/or/xor directly to memory's value.<p>This makes implementing locks and mutexes easier!<br> But it is still possible to implementing them without atomic instructions...</div><footer class=post-footer><div class=post-nav><div class=post-nav-item><a title="비선형방정식의 근" href=/posts/102/ rel=prev> <i class="fa fa-angle-left"></i> 비선형방정식의 근 </a></div><div class=post-nav-item></div></div></footer></article></div><div class="comments utterances-container"></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>© 2023 – <span itemprop=copyrightYear>2025</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>CookieHCl</span></div><div class=powered-by>Powered by <a href=https://hexo.io/ rel=noopener target=_blank>Hexo</a> & <a href=https://theme-next.js.org/muse/ rel=noopener target=_blank>NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div><div class=sidebar-dimmer></div><div aria-label="Back to top" class=back-to-top role=button><i class="fa fa-arrow-up fa-lg"></i><span>0%</span></div><div class=reading-progress-bar></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><script class=next-config data-name=utterances type=application/json>{"enable":true,"repo":"CookieHCl/cookiehcl.github.io","issue_term":"pathname","theme":"github-light"}</script><script defer src=/js/third-party/comments/utterances.js></script>