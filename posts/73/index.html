<!doctype html><html lang=en><meta charset=UTF-8><meta content="width=device-width" name=viewport><meta content=#222 name=theme-color><meta content="Hexo 8.1.1" name=generator><link crossorigin href=https://cdnjs.cloudflare.com rel=preconnect><link href=/images/apple-touch-icon-next.png rel=apple-touch-icon sizes=180x180><link href=/images/favicon-32x32-next.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16-next.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><link href=/css/main.css rel=stylesheet><link integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css rel=stylesheet><link integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css rel=stylesheet><script class=next-config data-name=main type=application/json>{"hostname":"cookiehcl.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"agate","dark":"agate"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":true,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script defer src=/js/config.js></script><meta content="Network layer Path-selection algorithms is implemented in  routing protocols: OSPF (inside 1 ISP), BGP (over multiple ISPs) SDN controller: Used in DC (data center)  Network layer uses IP protocol, bu" name=description><meta content=article property=og:type><meta content=IP property=og:title><meta content=https://cookiehcl.github.io/posts/73/index.html property=og:url><meta content="기억 저장소" property=og:site_name><meta content="Network layer Path-selection algorithms is implemented in  routing protocols: OSPF (inside 1 ISP), BGP (over multiple ISPs) SDN controller: Used in DC (data center)  Network layer uses IP protocol, bu" property=og:description><meta content=en_US property=og:locale><meta content=https://cookiehcl.github.io/posts/73/ip_datagram.png property=og:image><meta content=2025-04-23T07:38:49.000Z property=article:published_time><meta content=2025-04-23T07:38:49.000Z property=article:modified_time><meta content=CookieHCl property=article:author><meta content=summary name=twitter:card><meta content=https://cookiehcl.github.io/posts/73/ip_datagram.png name=twitter:image><link href=https://cookiehcl.github.io/posts/73/ rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://cookiehcl.github.io/posts/73/","path":"posts/73/","title":"IP"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>IP | 기억 저장소</title><script integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin defer src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script defer src=/js/utils.js></script><script defer src=/js/motion.js></script><script defer src=/js/sidebar.js></script><script defer src=/js/next-boot.js></script><script integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin defer src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js></script><script defer src=/js/third-party/search/local-search.js></script><script class=next-config data-name=mermaid type=application/json>{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.10.1/mermaid.min.js","integrity":"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="}}</script><script defer src=/js/third-party/tags/mermaid.js></script><script class=next-config data-name=enableMath type=application/json>true</script><link integrity="sha256-UF1fgpAiu3tPJN/uCqEUHNe7pnr+QR0SQDNfgglgtcM=" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css rel=stylesheet><script class=next-config data-name=katex type=application/json>{"copy_tex_js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js","integrity":"sha256-Us54+rSGDSTvIhKKUs4kygE2ipA0RXpWWh0/zLqw3bs="}}</script><script defer src=/js/third-party/math/katex.js></script><noscript><link href=/css/noscript.css rel=stylesheet></noscript><body class=use-motion itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label="Toggle navigation bar" class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <i class=logo-line></i> <p class=site-title>기억 저장소</p> <i class=logo-line></i> </a></div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=Search role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-about"><a href=/about/ rel=section><i class="fa fa-user fa-fw"></i>About</a><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>Tags</a><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>Categories</a><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>Archives</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>Search </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=Searching... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class=search-result-container><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>Table of Contents<li class=sidebar-nav-overview>Overview</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>1.</span> <span class=nav-text>Network layer</span></a><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>2.</span> <span class=nav-text>IP Datagram</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#First-header><span class=nav-number>2.1.</span> <span class=nav-text>First header</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#Second-header><span class=nav-number>2.2.</span> <span class=nav-text>Second header</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#IP-fragmentation><span class=nav-number>2.2.1.</span> <span class=nav-text>IP fragmentation</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#IP-reassembly><span class=nav-number>2.2.2.</span> <span class=nav-text>IP reassembly</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#Other-headers><span class=nav-number>2.3.</span> <span class=nav-text>Other headers</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>3.</span> <span class=nav-text>IP addressing</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#Subnet><span class=nav-number>3.1.</span> <span class=nav-text>Subnet</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#CIDR-Classless-InterDomain-Routing><span class=nav-number>3.1.1.</span> <span class=nav-text>CIDR (Classless InterDomain Routing)</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#DHCP-Dynamic-Host-Configuration-Protocol><span class=nav-number>3.2.</span> <span class=nav-text>DHCP (Dynamic Host Configuration Protocol)</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#DHCP-messages><span class=nav-number>3.2.1.</span> <span class=nav-text>DHCP messages</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#Network-s-IP-address><span class=nav-number>3.3.</span> <span class=nav-text>Network's IP address</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#ISP-s-IP-address><span class=nav-number>3.4.</span> <span class=nav-text>ISP's IP address</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>4.</span> <span class=nav-text>NAT (Network address translation)</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#NAT-router><span class=nav-number>4.1.</span> <span class=nav-text>NAT router</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#Criticism-of-NAT><span class=nav-number>4.2.</span> <span class=nav-text>Criticism of NAT</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>5.</span> <span class=nav-text>IPv6</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#IPv6-datagram-format><span class=nav-number>5.1.</span> <span class=nav-text>IPv6 datagram format</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#IPv6-adoption><span class=nav-number>5.2.</span> <span class=nav-text>IPv6 adoption</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>6.</span> <span class=nav-text>SDN (Software-Defined Networking)</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#Generalized-forwarding><span class=nav-number>6.1.</span> <span class=nav-text>Generalized forwarding</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#Generalized-forwarding-examples><span class=nav-number>6.2.</span> <span class=nav-text>Generalized forwarding examples</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>7.</span> <span class=nav-text>Middleboxes</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#IP-hourglass><span class=nav-number>7.1.</span> <span class=nav-text>IP hourglass</span></a></ol></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><p class=site-author-name itemprop=name>CookieHCl<div class=site-description itemprop=description></div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>103</span> <span class=site-state-item-name>posts</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>23</span> <span class=site-state-item-name>categories</span></a></div></nav></div><div class="links-of-author animated"><span class=links-of-author-item> <a rel="noopener me" title="GitHub → https://github.com/CookieHCl" href=https://github.com/CookieHCl target=_blank><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class=links-of-author-item> <a rel="noopener me" title="BOJ → https://www.acmicpc.net/user/CookieHCl" href=https://www.acmicpc.net/user/CookieHCl target=_blank><i class="fa fa-code fa-fw"></i>BOJ</a> </span><span class=links-of-author-item> <a rel="noopener me" title="solved.ac → https://solved.ac/profile/CookieHCl" href=https://solved.ac/profile/CookieHCl target=_blank><i class="fa fa-audio-description fa-fw"></i>solved.ac</a> </span></div><div class="cc-license animated" itemprop=license><a class=cc-opacity href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ko rel=noopener target=_blank><img alt="Creative Commons" src=https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg></a></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article lang=en><link href=https://cookiehcl.github.io/posts/73/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/images/avatar.gif itemprop=image> <meta content=CookieHCl itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content="기억 저장소" itemprop=name> <meta itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="IP | 기억 저장소" itemprop=name> <meta itemprop=description> </span><header class=post-header><h1 itemprop="name headline" class=post-title>IP</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>Posted on</span> <time itemprop="dateCreated datePublished" title="Created: 2025-04-23 16:38:49" datetime=2025-04-23T16:38:49+09:00>2025-04-23</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>In</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/SNU/ itemprop=url rel=index><span itemprop=name>SNU</span></a> </span> , <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/SNU/4-1/ itemprop=url rel=index><span itemprop=name>4-1</span></a> </span> , <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/SNU/4-1/%EC%BB%B4%ED%93%A8%ED%84%B0%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC/ itemprop=url rel=index><span itemprop=name>컴퓨터네트워크</span></a> </span> </span><span title="Reading time" class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>Reading time ≈</span> <span>6 mins.</span> </span></div></div></header><div class=post-body itemprop=articleBody><h1>Network layer</h1><p>Path-selection algorithms is implemented in<ul><li>routing protocols: OSPF (inside 1 ISP), BGP (over multiple ISPs)<li>SDN controller: Used in DC (data center)</ul><p>Network layer uses IP protocol, but ICMP protocol is also used.<br> ICMP is a network layer protocol that reports error between routers.<h1>IP Datagram</h1><p><img alt="IP Datagram" src=ip_datagram.png><p>Each header is 32 bits (4 bytes).<br> Theoretical maximum length of datagram is 64K bytes, but typically IP datagram's maximum length is 1500 bytes or less.<p>IP header size is 20 bytes in IPv4. (40 bytes in IPv6)<br> Theorically IP header can include more options, but it is not used.<p>Payload is typically a TCP or UDP segment.<h2 id=First-header>First header</h2><ul><li>First four bits is IP protocol version numer (4, 6)<br> The IPv5 protocol used to exist as an experiment, but it is no longer in use.<li>Header length (If header length is 5, actual header length is 5 * 4bytes = 20 bytes)<li>Type of service (e.g. ECN)<li>Total datagram length as bytes</ul><h2 id=Second-header>Second header</h2><p>Second header is used for fragmentation.<ul><li>16-bit packet identifier<li>Flags (Is fragmented?)<li>Fragment offset (divided by 8)</ul><h3 id=IP-fragmentation>IP fragmentation</h3><p>IP packet size can't exceed MTU (Maximum Transmission Unit). MTU is usually 1500 bytes.<br> If IP packet is larger than MTU, router will split packet into multiple MTU size packets. (fragmentation)<p>If offset is 0, this packet is the first fragment.<br> If flag is OFF, this packet is the last fragment.<p>e.g. Let's assume we need to send 4000 byte datagram, which has 20 bytes IP header.<p>Initial header looks like this: length=4000, ID=x, fragflag=0, offset=0.<br> This datagram is split into 3 packets:<ul><li>length=1500, ID=x, fragflag=1, offset=0<li>length=1500, ID=x, fragflag=1, offset=185 (1480/8)<li>length=1040, ID=x, fragflag=0, offset=370</ul><h3 id=IP-reassembly>IP reassembly</h3><p>We can reassembly IP packet with 16-bit identifier.<p>However, if packet is lost serious problem happens.<br> Since this is done in network layer, (at the router) we don't have retransmission and timeout.<p>Instead, we prove path MTU (smallest MTU in the path) and don't use fragmentation at all. (i.e. limit IP packet size to less than or equal to path MTU)<p>There is a path MTU discovery protocol, but it's not widely used (and can be abused).<br> Instead, we just think everybody is using 1500 byte MTU.<h2 id=Other-headers>Other headers</h2><ul><li>TTL (Time to live): Remaining max hops (decremented at each router)<li>Upper layer protocol (TCP/UDP)<li>Header checksum (only header, doesn't check payload)<li>32-bit source IP address<li>32-bit destionation IP address</ul><h1>IP addressing</h1><p>IP address is a 32-bit identifier associated with each host or router interface.<br> It is usually represented as a dotted-decimal IP address notation. e.g. 223.1.1.1<p>Interface is a connection between host/router and physical link.<br> Router typically have multiple interfaces, and host typically has one or two interfaces. Typically host use wired Ethernet and wireless 802.11 (Wi-Fi).<h2 id=Subnet>Subnet</h2><p>If we detach each interface from its host or router, we'll have islands of isolated networks, called subnet.<br> Subnet is a device interfaces that can physically reach each other without passing through an intervening router.<h3 id=CIDR-Classless-InterDomain-Routing>CIDR (Classless InterDomain Routing)</h3><p>Subnet is represented as a CIDR format a.b.c.d/x. e.g. 223.1.3.0/24<br> x is the number of bits in subnet part of IP address. (i.e. high-order x bits are same)<ul><li>Subnet part: Devices in same subnet have common high order bits.<li>Host part: Remaining low order bits are different for each devices.</ul><p>Initially, IP address was classful, e.g. Class A,B,C,D,E IP addresses.<ul><li>Class A: Starts with 0 (0~127), subnet part is 8 bits.<li>Class B: Starts with 10 (128~191), subnet part is 16 bits.<li>Class C: Starts with 110 (192~223), subnet part is 24 bits.<li>Class D: Starts with 1110 (224~239), subnet is not allowed.<li>Class E: Experimental, subnet is not allowed.</ul><p>But today we use classless IP address, and we can choose arbitrary length of subnet part.<br> Why? Because IPv4 address space is not enough!<br> We want a better utilization of IP addresses.<h2 id=DHCP-Dynamic-Host-Configuration-Protocol>DHCP (Dynamic Host Configuration Protocol)</h2><p>If host joins the network, it dynamically get IP address from server.<br> Widely used in wireless networks (Wi-Fi), but wired networks can also use DHCP.<p>DHCP can return more than just allocated IP address, e.g. name and IP address of DNS server, subnet mask, address of first-hop router for client.<p>Problem: What if DHCP server is malicious and gives already assigned IP address?<br> Modern DHCP server have authentication and its own defense mechanism (because host can be malicious too).<h3 id=DHCP-messages>DHCP messages</h3><ol><li>Host broadcasts DHCP discover message. (optional)<li>DHCP server responds with DHCP offer message. (optional)<li>Host requests IP address with DHCP request message.<li>DHCP server sends address with DHCP ack message.</ol><p>Host use 0.0.0.0 as a source IP address until it receives DHCP ack message. (i.e. until host gets IP address)<br> Host/DHCP server use 255.255.255.255 as a destination IP address because host doesn't have a IP address.<br> If destination is 255.255.255.255, this message will be broadcast to all machines in the network.<p>Since we cannot distinguish hosts with IP address, we use transaction ID.<h2 id=Network-s-IP-address>Network's IP address</h2><p>Network gets allocated portion of its provider ISP's address space.<p>e.g. ISP has 200.23.16.0/20 IP space.<br> This ISP can allocate its address space to 8 organization, such as:<br> 200.23.16.0/23, 200.23.18.0/23, ..., 200.23.30.0/23<p>ISP receives all IP packets destined for 200.23.16.0/20.<br> Then ISP can send IP packets to organizations depending on IP address, e.g. 200.23.16.0/23 goes to organization 1.<p>Recall) This is same as longest prefix match in routers!<h2 id=ISP-s-IP-address>ISP's IP address</h2><p>ICANN (Internet Corporation for Assigned Names and Numbers) allocates IP addresses through 5 regional registries (RRs).<br> ICANN also manages DNS root zone, delegates individual TLD, etc.<p>ICANN allocated last chunk of IPv4 addresses to RRs in 2011.<br> IPv6 has 128-bit address space, which is enough for assigning different IP addresses to each device.<p>However, IPv6 is not widely used because IPv4 was enough and IPv6 didn't make internet faster...<br> In fact, router can have smaller forwarding table if there are fewer networks.<h1>NAT (Network address translation)</h1><p>All devices in local network share just one IPv4 address for the internet!<br> (Sharing multiple IP address is possible, but typically only 1 IP address is shared.)<p>Advantages:<ul><li>Only one IP address is needed from provider ISP<li>Can change address of host in local network without notifying outside world<li>Can change ISP without changing addresses of devices in local network<li>Security: Devices inside local network is not directly addressable & visible by outside world</ul><h2 id=NAT-router>NAT router</h2><ul><li>For each outgoing datagram, NAT router replaces source (local IP address + port number) to (NAT IP address + new port number).<li>NAT router store translation pairs in NAT translation table.<li>For each incoming datagram, NAT router replaces destination (NAT IP address + port number) to (local IP address + port number) using NAT translation table.</ul><h2 id=Criticism-of-NAT>Criticism of NAT</h2><ul><li>Router should only process up to network layer, but NAT process up to transport layer (replaces port number)<li>Address shortage is supposed to be solved by IPv6<li>Violates end-to-end argument (network-layer device should only transport packets)<li>Client can't connect to server behind NAT (other method such as port forwarding is required)</ul><p>But NAT is extensively used in home networks, institutional networks, and 4G/5G cellular networks.<h1>IPv6</h1><p>Motivation: 32-bit IPv4 address space is completely allocated<p>Other motivations: More options - uses 40 byte fixed length header (c.f. IPv4 uses 20 byte header)<br> e.g. enable different network-layer tratment of flows, speed processing/forwarding<p>How does network operate with mixed IPv4 and IPv6 routers?<br> We use tunneling: IPv6 datagram is carried as payload in IPv4 datagram among IPv4 routers.<br> Routers determine IPv4 subpass, and use tunneling inside IPv4 pass. (We use IPv6 datagram directly outside IPv4 pass.)<h2 id=IPv6-datagram-format>IPv6 datagram format</h2><ul><li>Priority: Identify priority among datagrams in flow<li>Flow label: Identify datagrams in same flow (but concept of flow is not well defined...)<li>Payload length<li>Hop limit: Same as TTL<li>Source/destination address (128-bit)</ul><p>Unlike IPv4, IPv6 doesn't have checksum, fragmentation/reassembly, options.<br> IPv6 options are available as upper-layer, next-header protocol at router.<h2 id=IPv6-adoption>IPv6 adoption</h2><p>Google claims that about 48% of clients use IPv6. However 52% of clients still uses IPv4...<br> Korea tends to use IPv4, and Japan tends to use IPv6. <s>China have to use IPv6.</s><p>IPv6 came out 25 years ago, why is it taking so long?<br> There are hundreds of thousands of ISPs... They don't want to move to IPv6 because it doesn't make them money.<h1>SDN (Software-Defined Networking)</h1><p>Review: each router contains a forwarding table that forwards packets based on destination IP address.<p>SDN is software-defined, so we can use other fields and other operations.<br> Also, we can use algorithms other than shortest path, e.g. use backup links, prioritize some packets.<h2 id=Generalized-forwarding>Generalized forwarding</h2><p>We can abstract generalized forwarding into "Match + Action" abstraction.<ul><li>Match: Any pattern values in any packet header fields are matched. (e.g. MAC address, port number, etc.)<li>Actions: In addition to forwarding, you can also drop, copy, modify, and log packets. (Traditional router should only transport packets.)</ul><h2 id=Generalized-forwarding-examples>Generalized forwarding examples</h2><ul><li>Router matches longest destination IP prefix, then forward it out a link.<li>Firewall matches IP addresses and TCP/UDP port numbers, then permit or deny it.<li>NAT matches IP address and port, then rewrite IP address and port.</ul><h1>Middleboxes</h1><p>Middlebox is an any intermediary box performing functions apart from normal, standard functions of an IP router on the data path between a source host and destination host.<p>e.g. NAT, Firewalls, Web cache<p>Initially middleboxes started with blackbox hardware solutions, but it moved toward whitebox hardware implementing open API.<br> It can be implemented with programmable local actions via match + action, and it is moving towards innovation/differentiation in software.<h2 id=IP-hourglass>IP hourglass</h2><p>Criticism of IP?<p>There are many protocols in physical, link, transport, and application layers.<br> e.g. HTTP/SMTP/QUIC/DASH, TCP/UDP, Ethernet/Wi-Fi/Bluetooth, copper/radio/fiber<p>But there is only one network layer protocol: IP.<br> Why? IP is very simple and reliability is not needed.<br> IP must be implemented by every internet-connected devices.<p>Middleboxes are trying to solve this issue?<br> There is only one network layer protocol, but there are many middleboxes operating inside network layer.</div><footer class=post-footer><div class=post-nav><div class=post-nav-item><a title="Network Layer" href=/posts/69/ rel=prev> <i class="fa fa-angle-left"></i> Network Layer </a></div><div class=post-nav-item><a href=/posts/72/ rel=next title=Rendering> Rendering <i class="fa fa-angle-right"></i> </a></div></div></footer></article></div><div class="comments utterances-container"></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>© 2023 – <span itemprop=copyrightYear>2025</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>CookieHCl</span></div><div class=powered-by>Powered by <a href=https://hexo.io/ rel=noopener target=_blank>Hexo</a> & <a href=https://theme-next.js.org/muse/ rel=noopener target=_blank>NexT.Muse</a></div></div></footer><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div><div class=sidebar-dimmer></div><div aria-label="Back to top" class=back-to-top role=button><i class="fa fa-arrow-up fa-lg"></i><span>0%</span></div><div class=reading-progress-bar></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><script class=next-config data-name=utterances type=application/json>{"enable":true,"repo":"CookieHCl/cookiehcl.github.io","issue_term":"pathname","theme":"github-light"}</script><script defer src=/js/third-party/comments/utterances.js></script>